<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        body {
            margin: 0;       
        }

        .innhold {
            display: grid;
            height: 100vh;
        }

        .sideElement{
            padding: 6px;
        }

        table,
        tr,
        td,
        th {
            border: 1px solid gray;
            border-collapse: collapse;
        }

        td, th {
            padding: 4px;
        }

        .meny{
            background-color: darkcyan;
        }
    </style>
</head>

<body>
    <div id="side">
    </div>
    <script>
        let komponenter = {
            overskrift: function (data, metadata, parameterVerdi) {
                let p = data.tekst ? `<p>${data.tekst}</p>` : '';
                return `<div class="sideElement" style="grid-area: overskrift"><h3>${data.overskrift}</h3>${p}</div>`;
            },
            skjemaVisning: function (data, metadata, index) {
                return `<div class="sideElement" style="grid-area: skjemaVisning"><table style="text-align: left">
                          ${ metadata.map(f => 
                              `<tr>
                                <th>${ f.visningsnavn }</th>
                                <td>${ data[f.navn] }</td>
                              </tr>` ).join('') }
                        </table></div>`;
            },
            meny: function (data, metadata, index) {
                return `<div class="sideElement" style="grid-area: meny" class="meny"><h3>Meny</h3><ul>
                          ${ Object.keys(metadata).filter(navn=>metadata[navn].visningsnavn).map(navn => 
                              `<li><a href="javascript:app.visSide('${ navn }')">${ metadata[navn].visningsnavn }</a></li>` ).join('') }
                        </ul></div>`;
            },
        };

        class ProduktkatalogApp {
            constructor() {
                this.data = {
                    kategorier: ["kniv", "skje", "gaffel"],
                    produkter: [
                        { navn: "Gullskje 22cm", pris: 990, kategori: "skje" },
                        { navn: "Sølvskje 22cm", pris: 190, kategori: "skje" },
                        { navn: "Stålskje 22cm", pris: 19, kategori: "skje" },
                        { navn: "Gullkniv 22cm", pris: 990, kategori: "kniv" },
                        { navn: "Sølvkniv 22cm", pris: 190, kategori: "kniv" },
                        { navn: "Stålkniv 22cm", pris: 19, kategori: "kniv" },
                        { navn: "Gullgaffel 22cm", pris: 990, kategori: "gaffel" },
                        { navn: "Sølvgaffel 22cm", pris: 190, kategori: "gaffel" },
                        { navn: "Stålgaffel 22cm", pris: 19, kategori: "gaffel" }
                    ],
                    tekster: {
                        forside: {
                            overskrift: "Bestikkshoppen",
                            tekst: "Velkommen til Bestikkshoppen AS. Vi håper du får mange flotte handleopplevelser!",
                        },
                        info: {
                            telefon: '987 65 432',
                            slagord: 'Vi bestikker deg!'
                        },
                        kategorier: {
                            overskrift: "Kategorier",
                            tekst: "Denne siden viser alle våre produktkategorier. Velg en av dem for å se våre produkter. "
                        },
                        produkt: {
                            overskrift: "{{ obj.navn }}",
                            tekst: "Se detaljer om dette produktet under:"
                        },
                        kontaktOss: {
                            navn: "Bestikkshoppen AS",
                            adresse: "Melkeveien 1",
                            postnr: "0123",
                            poststed: "Oslo",
                            epost: "post@bestikkshoppen.no",
                            web: "www.bestikkshoppen.no"
                        }
                    }
                };
                this.metadata = {
                    felt: {
                        produkt: [
                            { navn: 'navn', visningsnavn: 'Navn' },
                            { navn: 'pris', visningsnavn: 'Pris', type: 'kroner' },
                            { navn: 'kategori', visningsnavn: 'Kategori' },
                        ],
                        forside: [
                            { navn: 'telefon', visningsnavn: 'Telefon' },
                            { navn: 'slagord', visningsnavn: 'Slagord' },
                        ],
                        kontaktOss: [
                            { navn: 'navn' },
                            { navn: 'adresse' },
                            { navn: 'postnr' },
                            { navn: 'poststed' },
                            { navn: 'epost' },
                            { navn: 'web' },
                        ]
                    },
                    sider: {
                        "forside": {
                            visningsnavn: 'Hjem',
                            mal: "infoSide",
                            data: { "overskrift": "tekster.forside", "skjemaVisning": "tekster.info" },
                            metadata: { "skjemaVisning": "felt.forside", "meny": "sider" },
                        },
                        "kategori-liste": {
                            visningsnavn: 'Kategorier',
                            mal: "listeSide",
                            data: { "overskrift": "tekster.kategorier", "liste-visning": "kategorier" }
                        },
                        "produkt-liste": {
                            mal: "listeSide",
                            data: { "overskrift": "tekster.produkt", "liste-visning": "kategorier" },
                            metadata: { "liste-visning": "produktFelt" }
                        },
                        "enkelt-produkt": {
                            mal: "infoSide",
                            data: { "overskrift": "tekster.produkt", "skjemaVisning": "produkter[i]" },
                            metadata: { "liste-visning": "produktFelt" }
                        },
                        "kontakt-oss": {
                            visningsnavn: 'Kontakt oss',                        
                            mal: "infoSide",
                            data: { "overskrift": "tekster.forside", "skjemaVisning": "tekster.kontaktOss" },
                            metadata: { "skjemaVisning": "produktFelt" }
                        }
                    },
                    maler: {
                        infoSide: {
                            komponenter: ["meny", "overskrift", "skjemaVisning"],
                            layout: {
                                rader: "200px auto",
                                kolonner: "200px auto",
                                mal: ["meny overskrift", "meny skjemaVisning"]
                            }
                        },
                        listeSide: {
                            komponenter: ["meny", "overskrift", "liste-visning"],
                            layout: {
                                rader: "200px auto",
                                kolonner: "200px auto",
                                mal: ["meny overskrift", "meny skjemaVisning"]
                            }
                        }
                    }
                };
            }

            visSide(sidenavn, parameter) {
                let metadataSide = this.metadata.sider[sidenavn];
                let metadataMal = this.metadata.maler[metadataSide.mal];
                let style = `
                    grid-template-rows: ${metadataMal.layout.rader};
                    grid-template-columns: ${metadataMal.layout.kolonner};
                    grid-template-areas: '${metadataMal.layout.mal.join(`' '`)}';
                    `;
                let innhold = metadataMal.komponenter.map(k => this.renderKomponent(k, metadataSide)).join('');
                document.getElementById('side').outerHTML =
                    `<div class="innhold" id="side" style="${style}">
                        <!-- ${sidenavn} -->
                        ${innhold}
                     </div>`;
            }

            renderKomponent(komponentNavn, metadataSide) {
                let komponentFunksjon = komponenter[komponentNavn];
                let dataSti = (metadataSide.data || {})[komponentNavn] || '';
                let metadataSti = (metadataSide.metadata || {})[komponentNavn] || '';
                return `<!-- start ${komponentNavn} --> 
                            ${komponentFunksjon(
                                this.hentVerdi(dataSti, this.data),
                                this.hentVerdi(metadataSti, this.metadata))}
                        <!-- slutt ${komponentNavn} --> `;
            }

            hentVerdi(sti, objekt) {
                for (let feltNavn of sti.split('.')) {
                    objekt = objekt[feltNavn];
                }
                return objekt;
            }
        }

        let app = new ProduktkatalogApp();
        app.visSide('forside');
    </script>
</body>

</html>